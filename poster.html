<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Poster Builder</title>
    <link rel="stylesheet" href="./src/style.css" />
  </head>
  <body class="min-h-screen bg-[radial-gradient(circle_at_15%_20%,rgba(45,91,255,0.08),transparent_55%),radial-gradient(circle_at_90%_10%,rgba(255,177,42,0.12),transparent_50%),#f4f1ea] text-slate-900" x-data="posterBuilder">
    <nav class="flex h-14 items-center border-b border-slate-800 bg-slate-900 px-6 text-white">
      <div class="flex items-center gap-3 text-lg font-semibold tracking-tight">
        <img src="/brihatech.svg" alt="Brihatech" class="h-8 w-auto" />
        <span>brihatools</span>
      </div>
    </nav>

    <main class="mx-auto max-w-6xl px-6 py-12">
      <section class="mb-10 flex flex-wrap items-end justify-between gap-6">
        <div>
          <h1 class="text-3xl font-semibold text-slate-900 md:text-4xl">Poster Builder</h1>
          <p class="mt-2 max-w-xl text-slate-600">
            Pick a poster, upload a portrait, and place it exactly where you want it.
          </p>
        </div>
      </section>

      <section class="grid gap-8 lg:grid-cols-[minmax(260px,360px)_minmax(0,1fr)]">
        <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-200/60">
          <h2 class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Poster Styles</h2>
          <div
            id="frameGrid"
            class="mt-4 grid grid-cols-3 gap-3"
            x-data="{
              frames: [
                '/frames/frame1.png',
                '/frames/frame2.png',
                '/frames/frame3.png',
                '/frames/frame4.png',
              ],
              activeFrame: null,
              setFrame(frame) {
                this.activeFrame = frame
              }
            }"
          >
            <template x-for="frame in frames" :key="frame">
              <button
                type="button"
                class="frame-button rounded-xl border bg-slate-50 transition hover:-translate-y-0.5 hover:shadow-md"
                :data-frame="frame"
                @click="setFrame(frame)"
                :class="activeFrame === frame
                  ? 'border-blue-500 ring-2 ring-blue-500/30 -translate-y-0.5'
                  : 'border-transparent'"
              >
                <img
                  :src="frame"
                  class="h-24 w-full object-cover"
                  alt="Frame preview"
                />
              </button>
            </template>
          </div>


          <div class="mt-6">
            <span class="text-sm text-slate-500">Upload Portrait Photo</span>
            <div class="mt-3 group relative">
              <input id="photoUpload" class="hidden" type="file" accept="image/*" x-ref="photoUpload" @change="onPhotoFileChange($event)" />
              <button
                id="uploadCard"
                class="flex w-full flex-col items-center justify-center gap-2 overflow-hidden rounded-2xl border border-dashed border-slate-300 bg-slate-50 px-4 py-6 text-slate-500 transition hover:border-slate-400 hover:bg-slate-100"
                type="button"
                @click="$refs.photoUpload.click()"
              >
                <img
                  id="photoPreview"
                  class="h-32 w-full rounded-xl object-cover"
                  alt="Photo preview"
                  x-show="hasPhoto"
                  :src="photoSrc"
                />
                <div id="uploadPlaceholder" class="flex flex-col items-center gap-2" x-show="!hasPhoto">
                  <span class="flex h-12 w-12 items-center justify-center rounded-full border border-slate-300 bg-white">
                    <svg class="h-6 w-6 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 5v14" />
                      <path d="M5 12h14" />
                    </svg>
                  </span>
                  <span class="text-xs font-semibold uppercase tracking-[0.2em]">Add portrait</span>
                  <span class="text-xs text-slate-400">PNG or JPG</span>
                </div>
              </button>
              <button
                id="removePhotoButton"
                class="absolute right-3 top-3 rounded-full bg-white/90 p-2 text-slate-600 shadow-sm opacity-0 transition group-hover:opacity-100"
                type="button"
                aria-label="Remove photo"
                x-show="hasPhoto"
                @click="clearPhoto()"
              >
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 6 6 18" />
                  <path d="M6 6 18 18" />
                </svg>
              </button>
            </div>
            <span class="mt-3 block text-xs text-slate-500">
              Tip: drag the photo on the canvas to position it.
            </span>
          </div>

          <!-- Scale Photo Slider -->
          <div class="mt-6 flex flex-col gap-3">
            <label class="text-sm text-slate-500" for="scaleRange">Scale Photo</label>
            <input
              id="scaleRange"
              class="w-full accent-blue-600"
              type="range"
              min="0.4"
              max="2.5"
              value="1"
              step="0.05"
              x-model.number="scale"
              x-ref="scaleRange"
            />
          </div>

          <!-- Input Fields for Name and Role -->
          <div class="mt-6 flex flex-col gap-3">
            <label class="text-sm text-slate-500" for="fullName">Full Name</label>
            <div class="relative">
              <input
                id="fullName"
                class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm"
                type="text"
                placeholder="Full Name"
                autocomplete="off"
                x-model="fullName"
                @input="onNameInput($event)"
                @focus="onNameFocus()"
                @blur="onNameBlur()"
                @keydown="onNameKeydown($event)"
                x-ref="fullNameInput"
              />
              <div
                id="nameSuggestions"
                class="absolute left-0 right-0 top-full z-20 mt-2 rounded-xl border border-slate-200 bg-white p-2 text-sm shadow-lg"
                x-show="nameSuggestionsVisible"
                @mousedown.prevent
              >
                <template x-for="(s, idx) in nameSuggestions" :key="idx">
                  <button
                    type="button"
                    class="flex w-full items-center rounded-lg px-3 py-2 text-left text-sm text-slate-700 hover:bg-slate-100"
                    :class="idx === 0 ? 'bg-slate-100' : ''"
                    @click="pickNameSuggestion(s)"
                    x-text="s"
                  ></button>
                </template>
              </div>
            </div>
          </div>


          <div class="mt-6 flex flex-col gap-3">
            <label class="text-sm text-slate-500" for="designation">Designation</label>
            <div class="relative">
              <input
                id="designation"
                class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm"
                type="text"
                placeholder="Designation"
                autocomplete="off"
                x-model="designation"
                @input="onRoleInput($event)"
                @focus="onRoleFocus()"
                @blur="onRoleBlur()"
                @keydown="onRoleKeydown($event)"
                x-ref="roleInput"
              />
              <div
                id="roleSuggestions"
                class="absolute left-0 right-0 top-full z-20 mt-2 rounded-xl border border-slate-200 bg-white p-2 text-sm shadow-lg"
                x-show="roleSuggestionsVisible"
                @mousedown.prevent
              >
                <template x-for="(s, idx) in roleSuggestions" :key="idx">
                  <button
                    type="button"
                    class="flex w-full items-center rounded-lg px-3 py-2 text-left text-sm text-slate-700 hover:bg-slate-100"
                    :class="idx === 0 ? 'bg-slate-100' : ''"
                    @click="pickRoleSuggestion(s)"
                    x-text="s"
                  ></button>
                </template>
              </div>
            </div>
          </div>

          <!-- Remove Background and Download Poster Buttons -->
           <div class="mt-4 flex flex-wrap items-center gap-3">
            <button
              id="removeBgButton"
              type="button"
              @click="removeBackground()"
              :disabled="!hasPhoto || removeBgBusy || removeBgUsed"
              class="inline-flex items-center gap-2 rounded-sm border border-indigo-600 bg-indigo-600
                    px-8 py-3 text-white transition
                    hover:bg-transparent hover:text-indigo-600
                    disabled:cursor-not-allowed disabled:opacity-50
                    disabled:hover:bg-indigo-600 disabled:hover:text-white"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M13.9258 12.7775L11.7775 10.6292C11.4847 10.3364 11.3383 10.19 11.1803 10.1117C10.8798 9.96277 10.527 9.96277 10.2264 10.1117C10.0685 10.19 9.92207 10.3364 9.62923 10.6292C9.33638 10.9221 9.18996 11.0685 9.11169 11.2264C8.96277 11.527 8.96277 11.8798 9.11169 12.1803C9.18996 12.3383 9.33638 12.4847 9.62923 12.7775L11.7775 14.9258M13.9258 12.7775L20.3708 19.2225C20.6636 19.5153 20.81 19.6617 20.8883 19.8197C21.0372 20.1202 21.0372 20.473 20.8883 20.7736C20.81 20.9315 20.6636 21.0779 20.3708 21.3708C20.0779 21.6636 19.9315 21.81 19.7736 21.8883C19.473 22.0372 19.1202 22.0372 18.8197 21.8883C18.6617 21.81 18.5153 21.6636 18.2225 21.3708L11.7775 14.9258M13.9258 12.7775L11.7775 14.9258" />
                <path d="M17 2L17.2948 2.7966C17.6813 3.84117 17.8746 4.36345 18.2556 4.74445C18.6366 5.12545 19.1588 5.31871 20.2034 5.70523L21 6L20.2034 6.29477C19.1588 6.68129 18.6366 6.87456 18.2556 7.25555C17.8746 7.63655 17.6813 8.15883 17.2948 9.2034L17 10L16.7052 9.2034C16.3187 8.15884 16.1254 7.63655 15.7444 7.25555C15.3634 6.87455 14.8412 6.68129 13.7966 6.29477L13 6L13.7966 5.70523C14.8412 5.31871 15.3634 5.12545 15.7444 4.74445C16.1254 4.36345 16.3187 3.84117 16.7052 2.7966L17 2Z" />
                <path d="M6 4L6.22108 4.59745C6.51097 5.38087 6.65592 5.77259 6.94167 6.05834C7.22741 6.34408 7.61913 6.48903 8.40255 6.77892L9 7L8.40255 7.22108C7.61913 7.51097 7.22741 7.65592 6.94166 7.94167C6.65592 8.22741 6.51097 8.61913 6.22108 9.40255L6 10L5.77892 9.40255C5.48903 8.61913 5.34408 8.22741 5.05833 7.94167C4.77259 7.65592 4.38087 7.51097 3.59745 7.22108L3 7L3.59745 6.77892C4.38087 6.48903 4.77259 6.34408 5.05833 6.05833C5.34408 5.77259 5.48903 5.38087 5.77892 4.59745L6 4Z" />
              </svg>

              <span class="text-sm font-medium">
                Remove Background
              </span>
            </button>

            <span
              id="removeBgStatus"
              class="text-xs text-slate-500"
              x-show="removeBgBusy || removeBgMessage"
              x-text="removeBgBusy ? 'Removing background…' : removeBgMessage"
            ></span>
          </div>

          <div class="mt-4 flex flex-wrap items-center gap-3">
            <button
              id="exportButton"
              type="button"
              @click="exportPoster()"
              :disabled="exportBusy"
              class="inline-flex items-center gap-2 rounded-sm border border-indigo-600
                    px-8 py-3 text-indigo-600 transition
                    hover:bg-indigo-600 hover:text-white
                    disabled:cursor-not-allowed disabled:opacity-50
                    disabled:hover:bg-transparent disabled:hover:text-indigo-600"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M2.99969 17.0002C2.99969 17.9302 2.99969 18.3952 3.10192 18.7767C3.37932 19.8119 4.18796 20.6206 5.22324 20.898C5.60474 21.0002 6.06972 21.0002 6.99969 21.0002L16.9997 21.0002C17.9297 21.0002 18.3947 21.0002 18.7762 20.898C19.8114 20.6206 20.6201 19.8119 20.8975 18.7767C20.9997 18.3952 20.9997 17.9302 20.9997 17.0002" />
                <path d="M16.4998 11.5002C16.4998 11.5002 13.1856 16.0002 11.9997 16.0002C10.8139 16.0002 7.49976 11.5002 7.49976 11.5002M11.9997 15.0002V3.00016" />
              </svg>

              <span 
                class="text-sm font-medium" 
                x-text="exportBusy ? 'Downloading…' : 'Download Poster'">
              </span>
            </button>

            <span
              id="exportStatus"
              class="text-xs text-slate-500"
              x-show="exportMessage"
              x-text="exportMessage"
            ></span>
          </div>
        </div>

        <div class="flex justify-center">
          <div
            class="relative w-full max-w-2xl overflow-hidden rounded-sm border border-slate-200 bg-transparent shadow-xl shadow-slate-200/60 aspect-3/4"
            id="stage"
            x-ref="stage"
          >
            <img
              class="absolute inset-0 h-full w-full object-contain"
              id="frameImage"
              :src="activeFrame"
              alt="Poster frame"
              x-ref="frameImage"
            />
            <img
              class="absolute left-1/2 top-1/2 w-[35%] select-none touch-none cursor-grab"
              id="photoImage"
              alt="Uploaded portrait"
              draggable="false"
              x-show="hasPhoto"
              :src="photoSrc"
              :style="photoTransformStyle"
              @pointerdown="onPhotoPointerDown($event)"
              @pointermove="onPhotoPointerMove($event)"
              @pointerup="onPhotoPointerUp($event)"
              @pointerleave="onPhotoPointerUp($event)"
              @pointercancel="onPhotoPointerUp($event)"
              x-ref="photoImage"
            />
            <div
              id="frameOverlay"
              class="pointer-events-none absolute"
              style="left: var(--frame-x, 0px); top: var(--frame-y, 0px); width: var(--frame-w, 100%); height: var(--frame-h, 100%);"
              x-ref="frameOverlay"
            >
              <div class="absolute bottom-[8%] left-[8%] flex flex-col gap-1 uppercase text-slate-900">
                <div
                  class="pointer-events-auto w-fit select-none touch-none rounded-full bg-transparent px-3 py-1 text-sm font-semibold cursor-grab sm:text-base"
                  id="nameText"
                  x-ref="nameText"
                  x-text="(fullName || 'Full Name').toUpperCase()"
                  :style="nameTransformStyle"
                  @pointerdown="onNamePointerDown($event)"
                  @pointermove="onNamePointerMove($event)"
                  @pointerup="onNamePointerUp($event)"
                  @pointerleave="onNamePointerUp($event)"
                  @pointercancel="onNamePointerUp($event)"
                >
                  Full Name
                </div>
                <div class="pointer-events-auto w-fit select-none touch-none rounded-full bg-transparent px-3 py-1 text-xs cursor-grab sm:text-sm" id="roleText"
                  x-ref="roleText"
                  x-text="(designation || 'Designation').toUpperCase()"
                  :style="roleTransformStyle"
                  @pointerdown="onRolePointerDown($event)"
                  @pointermove="onRolePointerMove($event)"
                  @pointerup="onRolePointerUp($event)"
                  @pointerleave="onRolePointerUp($event)"
                  @pointercancel="onRolePointerUp($event)"
                  >
                  Designation
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script type="module" src="/src/poster/main.ts"></script>
  </body>
</html>
